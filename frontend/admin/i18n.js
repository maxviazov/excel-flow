// Admin i18n
const translations = {
    he: {
        title: '× ×™×”×•×œ ×ž××’×¨×™ ×ž×™×“×¢',
        heading: '× ×™×”×•×œ ×ž××’×¨×™ ×ž×™×“×¢',
        citiesTab: '×¢×¨×™×',
        driversTab: '× ×”×’×™×',
        citiesManagement: '× ×™×”×•×œ ×¢×¨×™×',
        driversManagement: '× ×™×”×•×œ × ×”×’×™×',
        citySearch: 'ðŸ” ×—×™×¤×•×© ×œ×¤×™ ×§×•×“ ××• ×©×...',
        driverSearch: 'ðŸ” ×—×™×¤×•×© ×œ×¤×™ ×©× ××• ×˜×œ×¤×•×Ÿ...',
        importFromExcel: '×™×™×‘× ×ž×§×•×‘×¥ Excel',
        downloadTemplate: '×”×•×¨×“ ×ª×‘× ×™×ª Excel',
        addCity: '×”×•×¡×£ ×¢×™×¨',
        addDriver: '×”×•×¡×£ × ×”×’',
        addAlias: '×”×•×¡×£ ×›×™× ×•×™',
        cityCode: '×§×•×“ ×¢×™×¨',
        cityNameHeb: '×©× ×‘×¢×‘×¨×™×ª',
        cityNameEng: '×©× ×‘×× ×’×œ×™×ª',
        aliasHeb: '×›×™× ×•×™ ×‘×¢×‘×¨×™×ª',
        driverName: '×©× × ×”×’',
        driverCarNumber: '×ž×¡×¤×¨ ×¨×›×‘',
        driverPhone: '×˜×œ×¤×•×Ÿ',
        driverCityCodes: '×§×•×“×™ ×¢×¨×™× (×ž×•×¤×¨×“ ×‘×¤×¡×™×§)',
        driverCityNames: '×©×ž×•×ª ×¢×¨×™× (×ž×•×¤×¨×“ ×‘×¤×¡×™×§)',
        code: '×§×•×“',
        hebrewName: '×©× ×¢×‘×¨×™',
        englishName: '×©× ×× ×’×œ×™',
        type: '×¡×•×’',
        actions: '×¤×¢×•×œ×•×ª',
        name: '×©×',
        carNumber: '×ž×¡×¤×¨ ×¨×›×‘',
        phone: '×˜×œ×¤×•×Ÿ',
        cityCodes: '×§×•×“×™ ×¢×¨×™×',
        cityNames: '×©×ž×•×ª ×¢×¨×™×',
        delete: '×ž×—×§'
    },
    ru: {
        title: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…',
        heading: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…',
        citiesTab: 'Ð“Ð¾Ñ€Ð¾Ð´Ð°',
        driversTab: 'Ð’Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸',
        citiesManagement: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ð°Ð¼Ð¸',
        driversManagement: 'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑÐ¼Ð¸',
        citySearch: 'ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾Ð´Ñƒ Ð¸Ð»Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ...',
        driverSearch: 'ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð¸Ð»Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ...',
        importFromExcel: 'Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¸Ð· Excel',
        downloadTemplate: 'Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½ Excel',
        addCity: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ€Ð¾Ð´',
        addDriver: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ñ',
        addAlias: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿ÑÐµÐ²Ð´Ð¾Ð½Ð¸Ð¼',
        cityCode: 'ÐšÐ¾Ð´ Ð³Ð¾Ñ€Ð¾Ð´Ð°',
        cityNameHeb: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¸Ð²Ñ€Ð¸Ñ‚Ðµ',
        cityNameEng: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð¼',
        aliasHeb: 'ÐŸÑÐµÐ²Ð´Ð¾Ð½Ð¸Ð¼ Ð½Ð° Ð¸Ð²Ñ€Ð¸Ñ‚Ðµ',
        driverName: 'Ð˜Ð¼Ñ Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ñ',
        driverCarNumber: 'ÐÐ¾Ð¼ÐµÑ€ Ð¼Ð°ÑˆÐ¸Ð½Ñ‹',
        driverPhone: 'Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½',
        driverCityCodes: 'ÐšÐ¾Ð´Ñ‹ Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ)',
        driverCityNames: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ñ Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ)',
        code: 'ÐšÐ¾Ð´',
        hebrewName: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¸Ð²Ñ€Ð¸Ñ‚Ðµ',
        englishName: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð¼',
        type: 'Ð¢Ð¸Ð¿',
        actions: 'Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ',
        name: 'Ð˜Ð¼Ñ',
        carNumber: 'ÐÐ¾Ð¼ÐµÑ€ Ð¼Ð°ÑˆÐ¸Ð½Ñ‹',
        phone: 'Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½',
        cityCodes: 'ÐšÐ¾Ð´Ñ‹ Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð²',
        cityNames: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ñ Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð²',
        delete: 'Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ'
    },
    en: {
        title: 'Database Management',
        heading: 'Database Management',
        citiesTab: 'Cities',
        driversTab: 'Drivers',
        citiesManagement: 'Cities Management',
        driversManagement: 'Drivers Management',
        citySearch: 'ðŸ” Search by code or name...',
        driverSearch: 'ðŸ” Search by name or phone...',
        importFromExcel: 'Import from Excel',
        downloadTemplate: 'Download Excel Template',
        addCity: 'Add City',
        addDriver: 'Add Driver',
        addAlias: 'Add Alias',
        cityCode: 'City Code',
        cityNameHeb: 'Name in Hebrew',
        cityNameEng: 'Name in English',
        aliasHeb: 'Alias in Hebrew',
        driverName: 'Driver Name',
        driverCarNumber: 'Car Number',
        driverPhone: 'Phone',
        driverCityCodes: 'City Codes (comma separated)',
        driverCityNames: 'City Names (comma separated)',
        code: 'Code',
        hebrewName: 'Hebrew Name',
        englishName: 'English Name',
        type: 'Type',
        actions: 'Actions',
        name: 'Name',
        carNumber: 'Car Number',
        phone: 'Phone',
        cityCodes: 'City Codes',
        cityNames: 'City Names',
        delete: 'Delete'
    }
};

function detectBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage;
    if (browserLang.startsWith('he')) return 'he';
    if (browserLang.startsWith('ru')) return 'ru';
    if (browserLang.startsWith('en')) return 'en';
    return 'he';
}

let currentLang = localStorage.getItem('excelFlowLang') || detectBrowserLanguage();

function t(key) {
    return translations[currentLang][key] || key;
}

function setLanguage(lang) {
    if (!translations[lang]) return;
    currentLang = lang;
    localStorage.setItem('excelFlowLang', lang);
    document.documentElement.dir = lang === 'he' ? 'rtl' : 'ltr';
    document.documentElement.lang = lang;
    updateTranslations();
    updateLanguageButtons();
}

function updateTranslations() {
    document.title = t('title');
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = t(key);
        } else if (el.tagName === 'BUTTON') {
            const icon = el.textContent.match(/^[^\w\s]+/)?.[0] || '';
            el.textContent = icon + (icon ? ' ' : '') + t(key);
        } else {
            el.textContent = t(key);
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    setLanguage(currentLang);
    updateLanguageButtons();
});

function updateLanguageButtons() {
    document.querySelectorAll('[data-lang]').forEach(btn => {
        const lang = btn.getAttribute('data-lang');
        if (lang === currentLang) {
            btn.style.background = '#667eea';
            btn.style.color = 'white';
        } else {
            btn.style.background = 'white';
            btn.style.color = '#667eea';
        }
    });
}
