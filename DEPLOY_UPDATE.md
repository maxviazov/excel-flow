# Обновление деплоя после исправления маппинга городов

## Что было исправлено

Исправлена критическая ошибка в маппинге кодов городов:
- Коды городов теперь мапятся правильно по названию города, а не по улице
- В колонку "כתובת" записывается только улица (без города)
- Код города указывается в колонке "קוד עיר"

## Измененные файлы

- `internal/pipelines/sap.go` - исправлена логика маппинга адресов и поиска кодов городов

## Шаги для деплоя

### 1. Настройте AWS credentials (если еще не настроены)

```bash
aws configure
```

Введите:
- AWS Access Key ID
- AWS Secret Access Key
- Default region: us-east-1
- Default output format: json

### 2. Запустите деплой

```bash
# Простой деплой (обновление существующей инфраструктуры)
bash deploy.sh

# Или полный деплой с настройкой DNS
bash deploy-full.sh
```

### 3. Проверьте деплой

После успешного деплоя:
1. Откройте приложение по URL (будет показан в конце деплоя)
2. Загрузите тестовый файл `final/משקל.xlsx`
3. Проверьте, что коды городов мапятся правильно

## Ожидаемые результаты

После деплоя коды городов должны мапиться следующим образом:

| Город | Адрес (улица) | Код города |
|-------|---------------|------------|
| תל אביב | שדרות וושינגטון 28 | J112 |
| אשדוד | קיבוץ גלויות 1 | J501 |
| תל אביב | צוקרמן יצחק 8 | J112 |
| כפר סבא | דרך השרון 12 | I619 |
| רמת ישי | תחנת דלק סונול | C1243 |
| אשדוד | יקינתון 5 (מרכז כלניות) | J501 |
| תל אביב | הבושם 62 | J112 |
| ערד | בן יאיר 26 | N1109 |
| ירושלים | עולי גורדום 2 | H527 |
| נצרת עילית | רח' חרוד 7 | C1005 |
| ראשל"צ | הרצל 101 | J1207 |
| ראשל"צ | הגדוד העברי 52 | J1207 |

## Альтернативный деплой (без AWS CLI)

Если AWS CLI не настроен, можно использовать:

### Вариант 1: Docker Hub

```bash
# 1. Соберите образ
docker build -t yourusername/excel-flow:latest .

# 2. Загрузите в Docker Hub
docker push yourusername/excel-flow:latest

# 3. Обновите образ на сервере
ssh your-server "docker pull yourusername/excel-flow:latest && docker-compose up -d"
```

### Вариант 2: Прямой деплой на сервер

```bash
# 1. Соберите приложение
go build -o bin/excel-flow ./cmd/server

# 2. Скопируйте на сервер
scp -r bin/excel-flow configs web your-server:/app/

# 3. Перезапустите сервис
ssh your-server "systemctl restart excel-flow"
```

## Проверка после деплоя

```bash
# Проверьте логи
docker logs excel-flow

# Или на сервере
journalctl -u excel-flow -f
```

## Откат (если что-то пошло не так)

```bash
# Откатите Terraform
cd terraform
terraform destroy -auto-approve

# Или откатите Docker образ
docker pull yourusername/excel-flow:previous
docker-compose up -d
```
